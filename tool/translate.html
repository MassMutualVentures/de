<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>翻译测试 (via api.massmutualventures.de)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 24px; }
  .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
  textarea { width: 100%; min-height: 120px; padding: 12px; border: 1px solid #e5e7eb; border-radius: 10px; }
  select, button, input { padding: 10px 12px; border-radius: 10px; border: 1px solid #e5e7eb; }
  button { background: #111827; color: #fff; cursor: pointer; }
  button[disabled]{ opacity:.6; cursor:not-allowed; }
  .card { border:1px solid #e5e7eb; border-radius:12px; padding:16px; margin:12px 0; }
  .out { white-space: pre-wrap; border:1px solid #e5e7eb; border-radius:10px; padding:12px; min-height:84px; }
  .muted { color:#6b7280; font-size:13px; }
</style>
</head>
<body>
  <h1>翻译测试</h1>

  <div class="card">
    <div class="row">
      <label>目标语言：
        <select id="target">
          <option value="zh">中文</option>
          <option value="en">English</option>
        </select>
      </label>
      <button id="go">翻译测试</button>
      <span id="status" class="muted"></span>
    </div>
    <div style="margin-top:10px;">
      <textarea id="src" placeholder="在这里粘贴要翻译的文本（支持任意语言，自动识别）"></textarea>
    </div>
  </div>

  <div class="card">
    <h3>翻译结果</h3>
    <div id="dst" class="out">等待测试...</div>
  </div>

  <div class="card">
    <details>
      <summary>调试信息（仅排错用）</summary>
      <pre id="debug" class="muted" style="overflow:auto;"></pre>
    </details>
  </div>

<script>
const API_BASE = "https://api.massmutualventures.de"; // 你的代理

const el = {
  btn: document.getElementById("go"),
  status: document.getElementById("status"),
  src: document.getElementById("src"),
  dst: document.getElementById("dst"),
  target: document.getElementById("target"),
  debug: document.getElementById("debug"),
};

function setStatus(t){ el.status.textContent = t || ""; }
function setDebug(obj){ el.debug.textContent = typeof obj === "string" ? obj : JSON.stringify(obj, null, 2); }

function systemPrompt(target){
  if (target === "zh") {
    return "你是专业的翻译助手。把用户输入文本忠实、流畅地翻译成简体中文；保持术语、人名；如果原文已是中文，则原样返回。";
  } else {
    return "You are a professional translator. Translate the user input faithfully and fluently into English; keep proper nouns/terms; if the input is already English, return it as-is.";
  }
}

el.btn.addEventListener("click", async () => {
  const text = el.src.value.trim();
  if (!text) { alert("请先输入要翻译的文本"); return; }

  el.btn.disabled = true;
  el.dst.textContent = "请求中…";
  setStatus("调用 /v1/chat/completions …");
  setDebug("");

  try {
    const target = el.target.value;
    const res = await fetch(`${API_BASE}/v1/chat/completions`, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: [
          { role: "system", content: systemPrompt(target) },
          { role: "user", content: text }
        ],
        temperature: 0.2
      })
    });

    const hdr = Object.fromEntries(res.headers.entries());
    setDebug({ status: res.status, headers: hdr });

    if (!res.ok) {
      const errTxt = await res.text().catch(()=> "");
      el.dst.textContent = `请求失败：HTTP ${res.status} ${res.statusText}\n${errTxt}`;
      setStatus("失败");
      return;
    }

    const data = await res.json();
    const out = data?.choices?.[0]?.message?.content || "(空)";
    el.dst.textContent = out;
    setStatus("成功 ✅");
  } catch (e) {
    // 这里能抓到 CORS/网络类错误（浏览器通常报“TypeError: Failed to fetch”）
    el.dst.textContent = `错误：${e?.message || e}`;
    setDebug(String(e));
    setStatus("出错");
  } finally {
    el.btn.disabled = false;
  }
});
</script>
</body>
</html>
